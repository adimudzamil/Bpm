<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="PAX Report">
    <title>Passenger Meal & Tier Report - by *2100551*</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            -webkit-text-size-adjust: 100%;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border: 1px solid #ccc;
        }
        
        h1 {
            font-size: 18px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .input-section {
            margin-bottom: 20px;
        }
        
        textarea {
            width: 100%;
            height: 150px;
            font-family: 'Menlo', 'Monaco', 'Consolas', monospace;
            font-size: 12px;
            padding: 10px;
            border: 1px solid #333;
            resize: vertical;
            -webkit-appearance: none;
            -webkit-text-size-adjust: 100%;
            border-radius: 4px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 20px;
            font-size: 14px;
            font-weight: bold;
            border: 2px solid #000;
            background: #fff;
            cursor: pointer;
            font-family: -apple-system, BlinkMacSystemFont, Arial, sans-serif;
            border-radius: 4px;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        button:active {
            background: #000;
            color: #fff;
        }
        
        .output-section {
            margin-top: 20px;
        }
        
        .flight-info {
            font-size: 11px;
            font-weight: bold;
            padding: 8px;
            border: 2px solid #000;
            margin-bottom: 5px;
            text-align: center;
        }
        
        .stats {
            font-size: 10px;
            padding: 6px;
            border: 1px solid #000;
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .tables-container {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            justify-content: flex-start;
        }
        
        .table-wrapper {
            flex: 1;
            max-width: 50%;
        }
        
        .table-title {
            font-size: 11px;
            font-weight: bold;
            text-align: center;
            padding: 4px;
            border: 2px solid #000;
            background: #fff;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 9px;
            margin-top: 2px;
        }
        
        th, td {
            border: 1px solid #000;
            padding: 3px 4px;
            text-align: left;
        }
        
        th {
            font-weight: bold;
            background: #fff;
            font-size: 9px;
        }
        
        td {
            font-size: 9px;
        }
        
        .class-divider {
            border-top: 2px solid #000;
            font-weight: bold;
            text-align: center;
            background: #fff;
        }
        
        .unassigned-section {
            margin-top: 10px;
        }
        
        .unassigned-title {
            font-size: 11px;
            font-weight: bold;
            text-align: center;
            padding: 4px;
            border: 2px solid #000;
            background: #fff;
            margin-bottom: 2px;
        }
        
        .narrowbody-wrapper {
            max-width: 50%;
        }
        
        .narrowbody-wrapper .unassigned-title {
            text-align: left;
        }
        
        .narrowbody-wrapper .table-title {
            text-align: left;
        }
        
        .error {
            color: #000;
            padding: 10px;
            border: 2px solid #000;
            margin: 10px 0;
            font-size: 11px;
            background: #fff;
        }

        .infant-meal {
            font-size: 8px;
            color: #666;
            display: block;
            margin-top: 2px;
        }

        @media print {
            body {
                background: white;
                padding: 0;
                font-size: 10px;
                line-height: 1.2;
            }
            
            .container {
                border: none;
                padding: 5px;
                max-width: 100%;
            }
            
            .input-section {
                display: none;
            }
            
            button {
                display: none;
            }
            
            #printOutputBtn {
                display: none !important;
            }
            
            table {
                page-break-inside: avoid;
                font-size: 7px;
            }
            
            th, td {
                padding: 1px 2px;
                font-size: 7px;
                line-height: 1.1;
            }
            
            .flight-info {
                font-size: 9px;
                padding: 4px;
                margin-bottom: 3px;
            }
            
            .stats {
                font-size: 8px;
                padding: 3px;
                margin-bottom: 5px;
            }
            
            .table-title, .unassigned-title {
                font-size: 9px;
                padding: 2px;
            }
            
            .tables-container {
                gap: 5px;
                margin-bottom: 5px;
            }
            
            .infant-meal {
                font-size: 6px;
            }
            
            .narrowbody-wrapper {
                max-width: 100%;
            }
            
            .narrowbody-wrapper .table-wrapper {
                max-width: 100%;
            }
            
            @page {
                size: A4;
                margin: 0.5cm;
            }
            
            .instructions, .acknowledgments {
                display: none;
            }
        }

        #printOutputBtn {
            display: none;
            margin: 10px 0;
            background: #000;
            color: #fff;
            width: 100%;
        }

        @media print and (min-width: 1px) {
            .tables-container.compact-layout {
                column-count: 2;
                column-gap: 10px;
                display: block;
            }
            
            .tables-container.compact-layout .table-wrapper {
                break-inside: avoid;
                max-width: 100%;
                margin-bottom: 10px;
            }
            
            .tables-container.very-compact {
                column-count: 3;
            }
        }

        .instructions {
            margin-top: 30px;
            padding: 15px;
            border-top: 2px solid #ccc;
            font-size: 11px;
            line-height: 1.6;
        }
        
        .acknowledgments {
            margin-top: 20px;
            padding: 15px;
            border-top: 1px solid #ccc;
            font-size: 11px;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            button {
                min-height: 44px;
                font-size: 16px;
            }
            
            textarea {
                font-size: 16px;
                min-height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>PASSENGER MEAL & TIER REPORT by *2100551*</h1>
        
        <div class="input-section">
            <textarea id="manifestInput" placeholder="Paste passenger manifest here..." aria-label="Passenger manifest input"></textarea>
            <div class="button-group">
                <button onclick="generateReport()" aria-label="Generate passenger report">Generate Report</button>
                <button onclick="clearAll()">Clear</button>
                <button onclick="window.print()">Print Current Page</button>
            </div>
        </div>
        
        <div class="output-section">
            <button id="printOutputBtn" onclick="window.print()">Print Report Only</button>
            <div id="reportContent"></div>
        </div>
        
        <div class="instructions">
            <h2 style="font-size: 14px; margin-bottom: 10px; font-weight: bold;">HOW TO USE</h2>
            <ol style="margin-left: 20px;">
                <li style="margin-bottom: 8px;"><strong>Access BPM:</strong> Log into BPM</li>
                <li style="margin-bottom: 8px;"><strong>Navigate to Passenger List:</strong> Go to your flight → Click "Passenger List"</li>
                <li style="margin-bottom: 8px;"><strong>Select All Data:</strong> 
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>On android mobile, must use xclipper available on play store due to android copy limit restrictions:
                  Long press on the flight number(FLT NBR), select all, then use xcopy from xclipper or drag to select all passenger data down to "Showing X entries"</li>
                  <li>On iOS: Select from FLT NBR until end of pax list > copy</li>
                  <li>On desktop: Click before flight number (FLT NBR), hold Shift, scroll down and click after "Showing X entries"</li>
                    </ul>
                </li>
                <li style="margin-bottom: 8px;"><strong>Copy:</strong> Tap/Click "Copy" from the menu</li>
                <li style="margin-bottom: 8px;"><strong>Paste Here:</strong> Tap/Click in the text box above and paste (Ctrl+V or long press → Paste)</li>
                <li style="margin-bottom: 8px;"><strong>Generate:</strong> Click "Generate Report" button (or press Ctrl+Enter)</li>
                <li style="margin-bottom: 8px;"><strong>Print:</strong> Use "Print Report Only" button for paper-saving print (or press Ctrl+P)</li>
            </ol>
            
            <p style="margin-top: 15px;"><strong>Printing Tips:</strong></p>
            <ul style="margin-left: 20px;">
                <li>Use "Print Report Only" button to save paper - hides instructions</li>
                <li>For long lists, browser may auto-optimize layout</li>
                <li>Check print preview before printing</li>
                <li>Use "Save as PDF" option to save digitally</li>
                <li>Android> share print> save as pdf</li>
                <li>iOS> 3 dots> share> options> send as pdf</li>
            </ul>
            
            <p style="margin-top: 15px;"><strong>Updates in v1.2:</strong></p>
            <ul style="margin-left: 20px;">
                <li><strong>FIXED:</strong> BBML now displays correctly even when parent has SPML (e.g., AVML,BBML)</li>
                <li><strong>NEW:</strong> Keyboard shortcuts - Ctrl+Enter to generate, Ctrl+P to print</li>
                <li><strong>NEW:</strong> Separate infant meal count in statistics</li>
            </ul>
        </div>
        
        <div class="acknowledgments">
            <h2 style="font-size: 14px; margin-bottom: 10px; font-weight: bold;">ACKNOWLEDGMENTS</h2>
            <p style="margin-bottom: 5px;">This tool was made possible thanks to:</p>
            <ul style="margin-left: 20px;">
              <li><strong>Nadiya and Zayn Ikhlas</strong> - for the LOVE</li>
                <li><strong>Alif</strong> - For the initial problem of android copy paste, testing and valuable feedback. Alif ada portable printer!</li>
                <li><strong>Fahrin</strong> - For the idea, iOS testing and suggestions</li>
                <li><strong>Nurhadi, Nazim, Jessie Lau</strong> - For Android testing</li>
                <li><strong>Amalina</strong> - For ios testing and tutorial</li>
                <li><strong>Batch 3/25</strong> - For inspiring this project </li>
                <li><a href="https://spck.io/"><strong>SPCK editor</strong></a> - Spck editor for coding and git</li>
                <li><a href ="https://kaustubhpatange.github.io/XClipper/"><strong>Xclipper</strong></a> - Must have for android mobile</li>
                <li><a href="https://adimudzamil.github.io/ftl/"><strong>FTL calculator</strong></a> - if you wanna test it out for me, feedback needed</li>
                <li><a href="https://adimudzamil.github.io/roster/"><strong>Roster to Calendar</strong></a> - How i add roster to my calendar and set alarm for every flight</li>
            </ul>
            <p style="margin-top: 10px; font-style: italic;">Thank you all for your help during testing and for helping make this tool better for everyone! ✈️</p>
            
            <p style="margin-top: 15px; font-size: 10px; color: #666;">
                Version 1.2 | Created for cabin crew meal service | Print-optimized layout | BBML bug fixed!
                <br>Any bugs or feedback please contact Zayn Ikhlas when he is 21.
            </p>
        </div>
    </div>

    <script>
        const SEAT_PATTERN = /^\d{2}[A-K]$/i;
        const PNR_PATTERN = /^[A-Z0-9]{6,7}$/i;
        const CLASS_PATTERN = /^[JY]$/i;
        const FQTV_PATTERN = /^\d{6,12}$|^MH\d+$/i;
        
        function sanitizeInput(text) {
            return text
                .replace(/\r\n/g, '\n')
                .replace(/\r/g, '\n')
                .replace(/[\u200B-\u200D\uFEFF]/g, '')
                .replace(/\u00A0/g, ' ')
                .trim();
        }
        
        function parseMealField(mealString) {
            if (!mealString) return { parent: '', infant: '', combined: '' };
            
            const meals = mealString.split(',').map(m => m.trim());
            
            return {
                parent: meals.find(m => m !== 'BBML') || '',
                infant: meals.find(m => m === 'BBML') || '',
                combined: mealString
            };
        }
        
        function parseManifest(text) {
            text = sanitizeInput(text);
            
            const lines = text.split('\n').map(l => l.trim()).filter(l => l !== '');
            const passengers = [];
            let flightInfo = {
                flightNumber: '',
                sector: '',
                aircraft: '',
                date: '',
                stdLocal: ''
            };
            
            for (let i = 0; i < lines.length; i++) {
                if (lines[i] === 'FLT NBR' && i + 1 < lines.length) {
                    flightInfo.flightNumber = lines[i + 1];
                }
                if (lines[i] === 'Sector' && i + 1 < lines.length) {
                    flightInfo.sector = lines[i + 1];
                }
                if (lines[i] === 'ACFT' && i + 1 < lines.length) {
                    flightInfo.aircraft = lines[i + 1];
                }
                if (lines[i] === 'STD LT' && i + 1 < lines.length) {
                    const parts = lines[i + 1].split(/\s+/);
                    if (parts.length >= 2) {
                        flightInfo.date = parts[0];
                        flightInfo.stdLocal = parts[1];
                    }
                }
            }
            
            let startIndex = -1;
            
            for (let i = 0; i < lines.length; i++) {
                if (lines[i] === 'MEALS') {
                    startIndex = i + 1;
                    break;
                }
            }
            
            if (startIndex === -1) {
                for (let i = 0; i < lines.length; i++) {
                    if (lines[i] === 'Passenger & Meal Count' || lines[i].includes('Passenger & Meal Count')) {
                        startIndex = i + 1;
                        break;
                    }
                }
            }
            
            if (startIndex === -1) return { flightInfo, passengers };
            
            const titles = ['MR', 'MS', 'MRS', 'MISS', 'MSTR', 'DATO', 'DATIN', 'DTUK', 'TSRI', 'MDM', 'DR', 'PROF'];
            const tiers = ['ELIT', 'PLAT', 'GOLD', 'RUBY', 'SLVR', 'BLUE', 'SAPH', 'EMER'];
            
            let i = startIndex;
            while (i < lines.length) {
                const line = lines[i];
                
                if (line.includes('-- END of PAX List') || (line.includes('Showing') && line.includes('entries'))) {
                    break;
                }
                
                if (line === '-- CUT HERE --') {
                    i++;
                    continue;
                }
                
                const passenger = {
                    title: '',
                    name: '',
                    seat: '',
                    pnr: '',
                    class: '',
                    fqtv: '',
                    tier: '',
                    meal: ''
                };
                
                if (titles.includes(line)) {
                    passenger.title = line;
                    i++;
                    if (i >= lines.length) break;
                }
                
                if (i < lines.length && lines[i].includes('/')) {
                    passenger.name = lines[i];
                    i++;
                } else {
                    i++;
                    continue;
                }
                
                while (i < lines.length) {
                    const field = lines[i];
                    
                    if (titles.includes(field) || field.includes('/')) {
                        break;
                    }
                    
                    if (field === '-- CUT HERE --' || field.includes('-- END of PAX List')) {
                        break;
                    }
                    
                    if (!passenger.seat && SEAT_PATTERN.test(field)) {
                        passenger.seat = field.toUpperCase();
                    }
                    else if (!passenger.pnr && PNR_PATTERN.test(field)) {
                        passenger.pnr = field.toUpperCase();
                    }
                    else if (!passenger.class && CLASS_PATTERN.test(field)) {
                        passenger.class = field.toUpperCase();
                    }
                    else if (!passenger.fqtv && FQTV_PATTERN.test(field)) {
                        passenger.fqtv = field;
                    }
                    else if (!passenger.tier && tiers.includes(field.toUpperCase())) {
                        passenger.tier = field.toUpperCase();
                    }
                    else if (!passenger.meal && field.toUpperCase().includes('ML')) {
                        const upperField = field.toUpperCase();
                        
                        if (upperField.includes(',')) {
                            const potentialMeals = upperField.split(',').map(m => m.trim());
                            const validMeals = potentialMeals.filter(m => 
                                /^[A-Z]{4}$/i.test(m) && m.endsWith('ML')
                            );
                            
                            if (validMeals.length > 0) {
                                passenger.meal = validMeals.join(',');
                            }
                        } else {
                            if (/^[A-Z]{4}$/i.test(upperField) && upperField.endsWith('ML')) {
                                passenger.meal = upperField;
                            }
                        }
                    }
                    
                    i++;
                }
                
                if (passenger.name && passenger.class) {
                    passengers.push(passenger);
                }
            }
            
            return { flightInfo, passengers };
        }
        
        function detectAircraftType(passengers) {
            const widebodySeats = ['G', 'H', 'J', 'K'];
            for (const pax of passengers) {
                if (pax.seat) {
                    const seatLetter = pax.seat.slice(-1);
                    if (widebodySeats.includes(seatLetter)) {
                        return 'widebody';
                    }
                }
            }
            return 'narrowbody';
        }
        
        function getSeatSide(seat, aircraftType) {
            if (!seat) return null;
            const seatLetter = seat.slice(-1);
            
            if (aircraftType === 'widebody') {
                if (['A', 'B', 'C', 'D', 'E'].includes(seatLetter)) return 'port';
                if (['F', 'G', 'H', 'J', 'K'].includes(seatLetter)) return 'starboard';
            } else {
                if (['A', 'B', 'C'].includes(seatLetter)) return 'port';
                if (['D', 'E', 'F'].includes(seatLetter)) return 'starboard';
            }
            return null;
        }
        
        function getSeatRowNumber(seat) {
            if (!seat) return 999;
            return parseInt(seat.substring(0, 2));
        }
        
        function generateReport() {
            const input = document.getElementById('manifestInput').value;
            const output = document.getElementById('reportContent');
            const printBtn = document.getElementById('printOutputBtn');
            
            if (!input.trim()) {
                output.innerHTML = '<div class="error">Please paste passenger manifest data.</div>';
                printBtn.style.display = 'none';
                return;
            }
            
            try {
                const { flightInfo, passengers } = parseManifest(input);
                
                const filtered = passengers.filter(p => 
                    p.meal || p.tier === 'EMER' || p.tier === 'PLAT'
                );
                
                if (filtered.length === 0) {
                    output.innerHTML = '<div class="error">No passengers found with special meals or EMER/PLAT tier.</div>';
                    printBtn.style.display = 'none';
                    return;
                }
                
                const aircraftType = detectAircraftType(passengers);
                
                const sortBySeat = (a, b) => {
                    if (a.class !== b.class) return a.class === 'J' ? -1 : 1;
                    return getSeatRowNumber(a.seat) - getSeatRowNumber(b.seat);
                };
                
                let portPassengers, starboardPassengers, unassigned, assignedPassengers;
                
                if (aircraftType === 'narrowbody') {
                    assignedPassengers = filtered.filter(p => p.seat);
                    unassigned = filtered.filter(p => !p.seat);
                    assignedPassengers.sort(sortBySeat);
                } else {
                    portPassengers = filtered.filter(p => getSeatSide(p.seat, aircraftType) === 'port');
                    starboardPassengers = filtered.filter(p => getSeatSide(p.seat, aircraftType) === 'starboard');
                    unassigned = filtered.filter(p => !p.seat);
                    portPassengers.sort(sortBySeat);
                    starboardPassengers.sort(sortBySeat);
                }
                
                const specialMealCount = filtered.filter(p => p.meal).length;
                const tierCount = filtered.filter(p => p.tier === 'EMER' || p.tier === 'PLAT').length;
                
                let bbmlCount = 0;
                const mealCounts = {};
                filtered.forEach(p => {
                    if (p.meal) {
                        const meals = p.meal.split(',').map(m => m.trim());
                        meals.forEach(meal => {
                            if (meal === 'BBML') {
                                bbmlCount++;
                            } else if (meal) {
                                mealCounts[meal] = (mealCounts[meal] || 0) + 1;
                            }
                        });
                    }
                });
                
                const mealBreakdown = Object.entries(mealCounts)
                    .sort((a, b) => b[1] - a[1])
                    .map(([meal, count]) => `${meal}: ${count}`)
                    .join(', ');
                
                let html = '';
                
                if (aircraftType === 'narrowbody') {
                    html += `<div class="narrowbody-wrapper">`;
                }
                
                html += `<div class="flight-info">Flight: ${flightInfo.flightNumber} | Route: ${flightInfo.sector} | Date: ${flightInfo.date} ${flightInfo.stdLocal} | ACFT: ${flightInfo.aircraft}</div>`;
                
                html += `<div class="stats">`;
                html += `<strong>Summary:</strong> Special Meals: ${specialMealCount} | EMER/PLAT: ${tierCount}`;
                if (bbmlCount > 0) {
                    html += ` | Infants (BBML): ${bbmlCount}`;
                }
                html += `<br>`;
                html += `<strong>Meal Breakdown:</strong> ${mealBreakdown || 'None'}`;
                if (bbmlCount > 0) {
                    html += ` | BBML: ${bbmlCount}`;
                }
                html += `</div>`;
                
                if (aircraftType === 'narrowbody') {
                    html += `</div>`;
                }
                
                const compactClass = filtered.length > 50 ? 'compact-layout' : '';
                const veryCompactClass = filtered.length > 100 ? 'very-compact' : '';
                
                html += `<div class="tables-container ${compactClass} ${veryCompactClass}">`;
                
                if (aircraftType === 'narrowbody') {
                    html += `<div class="table-wrapper">`;
                    html += `<div class="table-title">ALL PASSENGERS</div>`;
                    html += generateTable(assignedPassengers, true);
                    html += `</div>`;
                } else {
                    html += `<div class="table-wrapper">`;
                    html += `<div class="table-title">PORT SIDE</div>`;
                    html += generateTable(portPassengers, true);
                    html += `</div>`;
                    
                    html += `<div class="table-wrapper">`;
                    html += `<div class="table-title">STARBOARD SIDE</div>`;
                    html += generateTable(starboardPassengers, true);
                    html += `</div>`;
                }
                
                html += `</div>`;
                
                if (unassigned.length > 0) {
                    if (aircraftType === 'narrowbody') {
                        html += `<div class="narrowbody-wrapper">`;
                    }
                    html += `<div class="unassigned-section">`;
                    html += `<div class="unassigned-title">UNASSIGNED SEATS</div>`;
                    html += `<table>`;
                    html += `<thead><tr><th>TITLE</th><th>NAME</th><th>TIER</th><th>MEAL</th></tr></thead>`;
                    html += `<tbody>`;
                    unassigned.forEach(p => {
                        const meals = parseMealField(p.meal);
                        let mealDisplay = '';
                        
                        if (meals.parent && meals.infant) {
                            mealDisplay = `<strong>${meals.parent}</strong><span class="infant-meal">(+${meals.infant})</span>`;
                        } else if (meals.parent) {
                            mealDisplay = `<strong>${meals.parent}</strong>`;
                        } else if (meals.infant) {
                            mealDisplay = `<strong>${meals.infant}</strong>`;
                        }
                        
                        html += `<tr>`;
                        html += `<td>${p.title}</td>`;
                        html += `<td>${p.name}</td>`;
                        html += `<td><strong>${p.tier}</strong></td>`;
                        html += `<td>${mealDisplay}</td>`;
                        html += `</tr>`;
                    });
                    html += `</tbody></table>`;
                    html += `</div>`;
                    if (aircraftType === 'narrowbody') {
                        html += `</div>`;
                    }
                }
                
                output.innerHTML = html;
                printBtn.style.display = 'block';
                
                document.querySelector('.input-section').style.display = 'none';
                
            } catch (error) {
                output.innerHTML = `<div class="error">Error parsing manifest: ${error.message}<br><br>Please make sure you copied the complete passenger list from BPM.</div>`;
                printBtn.style.display = 'none';
                console.error(error);
            }
        }
        
        function generateTable(passengers, showSeat = false) {
            if (passengers.length === 0) {
                const headers = showSeat ? '<th>SEAT</th><th>TITLE</th><th>NAME</th><th>TIER</th><th>MEAL</th>' : '<th>TITLE</th><th>NAME</th><th>TIER</th><th>MEAL</th>';
                return `<table><thead><tr>${headers}</tr></thead><tbody><tr><td colspan="${showSeat ? 5 : 4}" style="text-align:center;">No passengers</td></tr></tbody></table>`;
            }
            
            let html = `<table>`;
            const headers = showSeat ? '<th>SEAT</th><th>TITLE</th><th>NAME</th><th>TIER</th><th>MEAL</th>' : '<th>TITLE</th><th>NAME</th><th>TIER</th><th>MEAL</th>';
            html += `<thead><tr>${headers}</tr></thead>`;
            html += `<tbody>`;
            
            let lastClass = '';
            passengers.forEach(p => {
                if (p.class !== lastClass && lastClass !== '') {
                    html += `<tr class="class-divider"><td colspan="${showSeat ? 5 : 4}">--- Economy Class ---</td></tr>`;
                }
                lastClass = p.class;
                
                const meals = parseMealField(p.meal);
                let mealDisplay = '';
                
                if (meals.parent && meals.infant) {
                    mealDisplay = `<strong>${meals.parent}</strong><span class="infant-meal">(+${meals.infant})</span>`;
                } else if (meals.parent) {
                    mealDisplay = `<strong>${meals.parent}</strong>`;
                } else if (meals.infant) {
                    mealDisplay = `<strong>${meals.infant}</strong>`;
                }
                
                html += `<tr>`;
                if (showSeat) {
                    html += `<td><strong>${p.seat}</strong></td>`;
                }
                html += `<td>${p.title}</td>`;
                html += `<td>${p.name}</td>`;
                html += `<td><strong>${p.tier}</strong></td>`;
                html += `<td>${mealDisplay}</td>`;
                html += `</tr>`;
            });
            
            html += `</tbody></table>`;
            return html;
        }
        
        function clearAll() {
            document.getElementById('manifestInput').value = '';
            document.getElementById('reportContent').innerHTML = '';
            document.getElementById('printOutputBtn').style.display = 'none';
            document.querySelector('.input-section').style.display = 'block';
        }
        
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                const textarea = document.getElementById('manifestInput');
                if (textarea.value.trim()) {
                    e.preventDefault();
                    generateReport();
                }
            }
            if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                const reportContent = document.getElementById('reportContent');
                if (reportContent.innerHTML.trim()) {
                    e.preventDefault();
                    window.print();
                }
            }
        });
        </script>
        </body>
        </html>